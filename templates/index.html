{% extends "base.html" %}

{% block title %}Echo - 社交发布助手{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
{% endblock %}

{% block content %}
<!-- 功能已隐藏：发布前自检面板 (quality-panel) -->
<!-- 功能已隐藏：草稿箱面板 (draft-panel) -->

<div class="container">
    <button class="ai-button" id="refineBtn" title="AI 润色">
        <span class="icon" id="refineIcon" style="width: 16px; height: 16px;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.85 8.65l.65.65-.65.65-.65-.65.65-.65M12 4.58l2.5 2.5-2.5 2.5-2.5-2.5 2.5-2.5m9.07 3.07l-1.4-1.4-1.4 1.4 1.4 1.4 1.4-1.4M7.35 15.15l-.65-.65.65-.65.65.65-.65.65M12 19.42l-2.5-2.5 2.5-2.5 2.5 2.5-2.5 2.5m-7.07-3.07l1.4 1.4 1.4-1.4-1.4-1.4-1.4 1.4M18.85 15.35l.65-.65-.65-.65-.65.65.65.65M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z" fill="currentColor"/></svg>
        </span>
        <span>AI 润色</span>
    </button>

    <div class="editor-area">
        <div class="editor-wrapper">
            <textarea id="contentInput" placeholder="在此输入您的内容..."></textarea>
            <div class="char-counter" id="charCounter">0/140</div>
        </div>
    </div>
    
    <div class="image-preview-area">
        <div class="image-grid" id="imageGrid">
            {% for img in images %}
            <div class="image-item" data-id="{{ img.id }}" data-index="{{ loop.index0 }}" draggable="true">
                <div class="drag-handle">
                    <span class="icon" style="width: 12px; height: 12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/></svg>
                    </span>
                </div>
                <img src="{{ img.url }}" alt="Preview" draggable="false">
                <button class="remove-btn" onclick="event.stopPropagation(); removeImage('{{ img.id }}')">
                    <span class="icon" style="width: 10px; height: 10px;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/></svg>
                    </span>
                </button>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="footer-toolbar">
        <div class="toolbar-content">
            <div class="toolbar-left">
                <input type="file" id="fileInput" class="hidden" accept="image/*" multiple>
                <button class="btn btn-outline" onclick="document.getElementById('fileInput').click()">
                    <span class="icon" style="width: 16px; height: 16px;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" fill="currentColor"/></svg>
                    </span>
                    <span>添加图片</span>
                </button>

                <div class="platform-select" id="platformSelect">
                    <button class="platform-btn active" data-platform="twitter" title="X">
                        <span class="platform-icon" style="width: 16px; height: 16px;">
                            <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                        </span>
                    </button>
                    <button class="platform-btn active" data-platform="zhihu" title="知乎">
                        <span style="font-size: 12px; font-weight: 600;">知乎</span>
                    </button>
                </div>
            </div>
            
            <!-- 功能已隐藏：预览按钮 (previewBtn) -->
            <!-- 功能已隐藏：定时发布按钮 (scheduleBtn) -->
            <button class="btn btn-primary" id="publishBtn">
                <span>立即发布</span>
            </button>
        </div>
    </div>
</div>

    <div class="progress-drawer" id="progressDrawer">
    <div class="progress-drawer-header">
        <div class="progress-title">发布进度</div>
        <button class="progress-close" id="progressClose">
            <span class="icon" style="width: 20px; height: 20px;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/></svg>
            </span>
        </button>
    </div>
    <div class="progress-list" id="progressList"></div>
    <div class="progress-result" id="progressResult"></div>
</div>

<div class="toast" id="toast"></div>

<!-- 功能已隐藏：预览模态框 (previewModal) -->
<!-- 功能已隐藏：定时发布模态框 (scheduleModal) -->
<!-- 功能已隐藏：键盘快捷键提示 (shortcuts-hint) -->
{% endblock %}

{% block extra_js %}
<script>
    window.INITIAL_IMAGES = {{ images | tojson }};
</script>
<script src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %}
